{% extends "layout.html" %} {% block content %}

<xml xmlns="https://developers.google.com/blockly/xml" id="workspaceBlocks" style="display: none"></xml>
<script src="https://unpkg.com/blockly/blockly.min.js"></script>

<!-- <script src="../static/scripts/blockly_compressed.js"></script>
<script src="../static/scripts/blocks_compressed.js"></script>
<script src="../static/scripts/javascript_compressed.js"></script>
<script src="../static/scripts/en.js"></script> -->
<script src="../static/scripts/block.js"></script>

<!-- <script src="../static/scripts/music_maker.js"></script>
<script src="../static/scripts/sound_blocks.js"></script> -->
<!-- <script src="scripts/workspace.js"></script>
<script src="scripts/main.js"></script> -->

<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h1">CONTROL Terminal</h1>
    <a class="btn btn-primary btn-lg" data-bs-toggle="collapse" href="#collapseLevels" role="button"
        aria-expanded="false" aria-controls="collapseLevels">
        Levels / Maps
    </a>
</div>

<div class="collapse mb-3" id="collapseLevels">
    <div class="card card-body">
        <ul class="list-group list-group-horizontal border-0">
            <input class="list-group-item-check" type="radio" name="listGroupCheckableRadios" id="level1" value=""
                checked>
            <label class="list-group-item py-3" for="level1">
                1. Moving Forward
                <span class="d-block small opacity-50">Level 1</span>
            </label>

            <input class="list-group-item-check" type="radio" name="listGroupCheckableRadios" id="level2" value="">
            <label class="list-group-item py-3" for="level2">
                2. Turning
                <span class="d-block small opacity-50">Level 2</span>
            </label>

            <input class="list-group-item-check" type="radio" name="listGroupCheckableRadios" id="level3" value="">
            <label class="list-group-item py-3" for="level3">
                3. For-Loop
                <span class="d-block small opacity-50">Level 3</span>
            </label>

            <input class="list-group-item-check" type="radio" name="listGroupCheckableRadios" id="level4" value="">
            <label class="list-group-item py-3" for="level4">
                4. If-Else Loop
                <span class="d-block small opacity-50">This option is disabled</span>
            </label>
            <input class="list-group-item-check" type="radio" name="listGroupCheckableRadios" id="level5" value="">
            <label class="list-group-item py-3" for="level5">
                5. Hello
                <span class="d-block small opacity-50">Something level here.</span>
            </label>
            <input class="list-group-item-check" type="radio" name="listGroupCheckableRadios" id="level6" value="">
            <label class="list-group-item py-3" for="level6">
                6. Hello on the other side.
                <span class="d-block small opacity-50">Something level here.</span>
            </label>
            <input class="list-group-item-check" type="radio" name="listGroupCheckableRadios" id="level7" value="">
            <label class="list-group-item py-3" for="level7">
                7. Insert text here.
                <span class="d-block small opacity-50">Something Something.</span>
            </label>
            <input class="list-group-item-check" type="radio" name="listGroupCheckableRadios" id="level8" value="">
            <label class="list-group-item py-3" for="level8">
                8. HellooOO.
                <span class="d-block small opacity-50">hELLO.</span>
            </label>
        </ul>
    </div>
</div>

<div class="row mb-2">
    <div class="col-md-12">
        <div class="row g-0 border rounded overflow-hidden flex-md-row mb-4 shadow-sm h-md-250 position-relative"
            style="height: 520px;">
            <div class="col-md-8 p-1 d-flex flex-column position-static"><svg class="bd-placeholder-img" width="auto"
                    height="auto" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Placeholder: MAP"
                    preserveAspectRatio="xMidYMid slice" focusable="false">
                    <title>Map</title>
                    <rect width="100%" height="100%" fill="#EDEDED" />
                    <text x="50%" y="50%" fill="black" dy=".1em">Map</text>
                </svg>
            </div>
            <div class="col-md-4 border-1 bg-light p-1">
                <div class="col-md-12 d-flex flex-column position-static ps-2 pt-2">
                    <strong class="d-inline-block mb-2 text-primary">Queued</strong>
                    <div class="table-responsive">
                        <table class="table table-striped table-sm ">
                            <thead>
                                <tr>
                                    <th scope="col ">#</th>
                                    <th scope="col ">Command</th>
                                    <th scope="col ">Header</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>1</td>
                                    <td>Forward</td>
                                    <td>data</td>
                                </tr>
                                <tr>
                                    <td>2</td>
                                    <td>Left</td>
                                    <td>irrelevant</td>
                                </tr>
                                <tr>
                                    <td>3</td>
                                    <td>Right</td>
                                    <td>rich</td>
                                </tr>
                                <tr>
                                    <td>4</td>
                                    <td>Right</td>
                                    <td>random</td>
                                </tr>
                                <tr>
                                    <td>5</td>
                                    <td>Left</td>
                                    <td>irrelevant</td>
                                </tr>
                                <tr>
                                    <td>6</td>
                                    <td>Back</td>
                                    <td>rich</td>
                                </tr>
                                <tr>
                                    <td>7</td>
                                    <td>Left</td>
                                    <td>placeholder</td>
                                </tr>
                                <tr>
                                    <td>8</td>
                                    <td>Right</td>
                                    <td>placeholder</td>
                                </tr>
                                <tr>
                                    <td>9</td>
                                    <td>Left</td>
                                    <td>irrelevant</td>
                                </tr>
                                <tr>
                                    <td>10</td>
                                    <td>Left</td>
                                    <td>illustrative</td>
                                </tr>
                                <tr>
                                    <td>11</td>
                                    <td>Back</td>
                                    <td>tabular</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="row mb-5">
    <div class="col-sm-8" style="height: 600px;">
        <div class="card h-100 position-relative d-flex flex-row">
            <div class="card-body">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-2 pb-2 mb-3">
                    <strong class="d-inline-block text-dark mb-2">Drag and drop to configure Commands.</strong>
                    <div class="btn-group me-1 float-end" role="group">
                        <button type="button" onclick="clearCode()" class="btn btn-danger ">Clear Commands</button>
                        <button type="button" class="btn btn-success " onclick="showCode()">Send Commands</button>
                    </div>
                </div>
                <div class="blockly-editor ">
                    <div id="blocklyDiv" style="height: 500px; width: 820px;"></div>
                    <xml id="toolbox" style="display: none">
                        <block type="forward"></block>
                        <block type="turn"></block>
                        <block type="print"></block>
                        <block type="repeatuntilend"></block>
                        <block type="controls_if"></block>
                        <block type="controls_repeat_ext"></block>
                        <block type="math_number">
                            <field name="NUM">123</field>
                        </block>
                        <block type="text_print"></block>
                    </xml>
                    <xml id="startBlocks" style="display: none">
                    </xml>
                </div>
            </div>
        </div>
    </div>
    <div class="col-sm-4 ">
        <div class="p-2 p-md-4 mb-4 text-white rounded bg-secondary h-100">
            <div class="col-md-12 ">
                <div class=" border-bottom mb-4">
                    <strong class="d-inline-block mb-2 text-white">Command List</strong>
                </div>
                <!-- <ul id="sqnce-list"></ul> -->
                <p class="mt-2" id="textArea">
                </p>
            </div>
        </div>
    </div>
</div>
<script>
    var workspace = Blockly.inject('blocklyDiv',
        {
            toolbox: document.getElementById('toolbox'
            ), trashcan: true
        });

    Blockly.Xml.domToWorkspace(document.getElementById('startBlocks'), workspace);
    function showCode() {
        // Generate code and display it.
        Blockly.JavaScript.INFINITE_LOOP_TRAP = null;
        Blockly.JavaScript.addReservedWords('code');

        var code = Blockly.JavaScript.workspaceToCode(workspace);
        // alert(code);
        document.getElementById('textArea').innerText = code;
    }

    function clearCode() {
        document.getElementById('textArea').innerText = "";
    }

    // function runCode() {
    //     // Generate JavaScript code and run it.
    //     window.LoopTrap = 1000;
    //     Blockly.JavaScript.INFINITE_LOOP_TRAP =
    //         'if (--window.LoopTrap == 0) throw "Infinite loop.";\n';
    //     var code = Blockly.JavaScript.workspaceToCode(workspace);
    //     Blockly.JavaScript.INFINITE_LOOP_TRAP = null;
    //     try {
    //         eval(code);
    //     } catch (e) {
    //         alert(e);
    //     }
    // }

    document.getElementById("execute_btn").onclick = function () {
        const ul = document.getElementById('sqnce-list');
        const listItems = ul.getElementsByTagName('li');

        // Loop through the NodeList object.
        for (let i = 0; i <= listItems.length - 1; i++) {
            var http = new XMLHttpRequest();
            var url = 'http://127.0.0.1:5000/car/commands';
            var params = 'direction=webportal&command=' + listItems[i].innerHTML;
            http.open('POST', url, true);

            //Send the proper header information along with the request
            http.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
            http.send(params);
        }
    }
</script>
{% endblock %}